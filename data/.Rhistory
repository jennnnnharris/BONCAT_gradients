lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
plant.p
windows(title="PCoA on OTUs - Bray Curtis")
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1,2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(otus.p, col=c("black"),
pch=c(20,21,22,23,24)[as.factor(metadat$Fraction)],
lwd=1,cex=2,
#bg=c("#003f5c","grey", "#bc5090", "#ffa600")[as.factor(metadat$BONCAT)])
bg=c( "#52311f","grey", "#f538de","#ffb4f6", "#276602", "#5ef507", "#dbfcc7", "#4406e2", "#a483f7"  )[metadat$compartment_BCAT])
# Calculate Bray-Curtis distance between samples
otus.bray<-vegdist(otu_table(ps), method = "bray")
# Perform PCoA analysis of BC distances #
otus.pcoa <- cmdscale(otus.bray, k=(ncol(otus)-1), eig=TRUE)
# Store coordinates for first two axes in new variable #
otus.p <- otus.pcoa$points[,1:2]
# Calculate % variance explained by each axis #
otus.eig<-otus.pcoa$eig
perc.exp<-otus.eig/(sum(otus.eig))*100
pe1<-perc.exp[1]
pe2<-perc.exp[2]
## Plot ordination with factors coloured and shaped as you like #
setwd("C:/Users/Jenn/The Pennsylvania State University/Burghardt, Liana T - Burghardt Lab Shared Folder/Projects/BONCAT/Data/")
windows(title="PCoA on OTUs - Bray Curtis")
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1,2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(otus.p, col=c("black"),
pch=c(20,21,22,23,24)[as.factor(metadat$Fraction)],
lwd=1,cex=2,
#bg=c("#003f5c","grey", "#bc5090", "#ffa600")[as.factor(metadat$BONCAT)])
bg=c( "#52311f","grey", "#f538de","#ffb4f6", "#276602", "#5ef507", "#dbfcc7", "#4406e2", "#a483f7"  )[metadat$compartment_BCAT])
# subset
p<-otus.p[which(metadat$Fraction != "Total_Cells"),]
# subset metadata
metadat_in<-metadat%>% filter(Fraction !="Total_Cells")
as.factor(metadat_in$Compartment)
as.factor(metadat_in$Fraction)
as.factor(metadat_in$compartment_BCAT)
levels(as.factor(metadat_in$compartment_BCAT))
levels(as.factor(metadat_in$Fraction))
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1,2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(p, col=c("black"),
pch=c(22,21,0,24, 23 )[as.factor(metadat_in$Fraction)],
lwd=1,cex=2,
bg=c("black", "#739AFF", "white", "#DC267F", "#DC267F", "#785EF0", "#785EF0" , "#785EF0", "#FFB000", "#FFB000")[as.factor(metadat_in$compartment_BCAT)])
legend("top",legend=c("beads", "Bulk_SoilTotal_DNA" ,      "neg control"   ,  "NoduleBONCAT_Active"    ,  "NoduleInactive"     ,      "RhizosphereBONCAT_Active",
"RhizosphereInactive","RhizosphereTotal_DNA" ,    "RootsBONCAT_Active"   ,    "RootsInactive"),
pch=c(15,5,0,1,2 , 1, 2 , 5, 1, 2),
col= c("black", "#739AFF", "black", "#DC267F", "#DC267F", "#785EF0", "#785EF0" , "#785EF0", "#FFB000", "#FFB000"),
bty = "n",
inset = c(.05, 0))
# subset
soil.p<-otus.p[which(metadat$Fraction != "Total_Cells"),]
soil.p<-plant.p[which(metadat_in$Compartment !="Nodule" & metadat_in$Compartment !="Roots" ),]
# subset metadata
metadat_in<-metadat%>% filter(Fraction !="Total_Cells")
# subset
soil.p<-otus.p[which(metadat$Fraction != "Total_Cells"),]
soil.p<-plant.p[which(metadat_in$Compartment !="Nodule" & metadat_in$Compartment !="Roots" ),]
soil.p
metadat_in
metadat_in$Compartment
soil.p<-soil.p[which(metadat_in$Compartment !="Nodule" & metadat_in$Compartment !="Roots" ),]
# Calculate % variance explained by each axis #
otus.eig<-otus.pcoa$eig
perc.exp<-otus.eig/(sum(otus.eig))*100
pe1<-perc.exp[1]
pe2<-perc.exp[2]
pe3<-perc.exp[3]
pe4<-perc.exp[4]
pe5<-perc.exp[5]
#to make coloring things easier I'm gong to added a combined fractionXboncat column no sure if i need this
metadat_so<-metadat%>% filter(Compartment !="Nodule") %>% filter(Compartment!="Roots") %>% filter(Fraction != "Total_Cells")
metadat_so
as.factor(metadat_so$compartment_BCAT)
points(plant.p,
pch=c(22,21,0,24)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","blue", "white", "purple", "purple",  "purple")[as.factor(metadat_so$compartment_BCAT)])
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","blue", "white", "purple", "purple",  "purple")[as.factor(metadat_so$compartment_BCAT)])
as.factor(metadat_so$Fraction)
points(soil.p,
pch=c(22,21,0,24, 24)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","blue", "white", "purple", "purple",  "purple")[as.factor(metadat_so$compartment_BCAT)])
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","blue", "white", "purple", "purple",  "purple")[as.factor(metadat_so$compartment_BCAT)])
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
as.factor(metadat_so$compartment_BCAT)
legend("top",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "black", "#DC267F", "#DC267F",  "#FFB000", "#FFB000"  ),
inset = c(.2, 0),
bty = "n")
legend("top",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,0, 5, 1,2,5),
cex=1.1,
col=c("black", "black", "#DC267F", "#DC267F",  "#FFB000", "#FFB000"  ),
inset = c(.2, 0),
bty = "n")
legend("top",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,0, 5, 1,2,5),
cex=1.1,
col=c("black", "black", "#DC267F", "#DC267F",  "#FFB000", "#FFB000"  ),
inset = c(.2, 0),
bty = "n")
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("top",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,0, 5, 1,2,5),
cex=1.1,
col=c("black", "black", "#DC267F", "#DC267F",  "#FFB000", "#FFB000"  ),
inset = c(.2, 0),
bty = "n")
legend("top",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#DC267F", "#DC267F",  "#FFB000", "#FFB000"  ),
inset = c(.2, 0),
bty = "n")
legend("top",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
inset = c(.2, 0),
bty = "n")
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("top",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
inset = c(.2, 0),
bty = "n")
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
inset = c(., 0),
bty = "n")
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3 (",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
dev.off()
## Plot ordination with factors coloured and shaped as you like #
#setwd("C:/Users/Jenn/The Pennsylvania State University/Burghardt, Liana T - Burghardt Lab Shared Folder/Projects/BONCAT/Data/")
svg(file="figures/16s/Pc3.pc4.soil.svg",width = 6, height=6 )
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3 (",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
dev.off()
## Plot ordination with factors coloured and shaped as you like #
#setwd("C:/Users/Jenn/The Pennsylvania State University/Burghardt, Liana T - Burghardt Lab Shared Folder/Projects/BONCAT/Data/")
svg(file="figures/16s/Pc1.pc2.soil.svg",width = 6, height=6 )
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
dev.off()
#------------subset by groups------------
# Store coordinates for axes 3 adn 4 in new variable #
otus.p <- otus.pcoa$points[,1:4]
# subset
plant.p<-otus.p[which(metadat$Fraction != "Total_Cells"),]
plant.p<-plant.p[which(metadat_in$Compartment !="Rhizosphere" & metadat_in$Compartment !="Bulk_Soil" ),]
# Calculate % variance explained by each axis #
otus.eig<-otus.pcoa$eig
perc.exp<-otus.eig/(sum(otus.eig))*100
pe1<-perc.exp[1]
pe2<-perc.exp[2]
pe3<-perc.exp[3]
pe4<-perc.exp[4]
pe5<-perc.exp[5]
#to make coloring things easier I'm gong to added a combined fractionXboncat column no sure if i need this
metadat_pl<-metadat%>% filter(Compartment !="Rhizosphere") %>% filter(Compartment!="Bulk_Soil") %>% filter(Fraction != "Total_Cells")
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(plant.p,
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
# subset
p<-otus.p[which(metadat$Fraction != "Total_Cells"),]
# subset metadata
metadat_in<-metadat%>% filter(Fraction !="Total_Cells")
as.factor(metadat_in$Compartment)
as.factor(metadat_in$Fraction)
as.factor(metadat_in$compartment_BCAT)
levels(as.factor(metadat_in$compartment_BCAT))
levels(as.factor(metadat_in$Fraction))
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1,2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(p, col=c("black"),
pch=c(22,21,0,24, 23 )[as.factor(metadat_in$Fraction)],
lwd=1,cex=2,
bg=c("black", "#739AFF", "white", "#DC267F", "#DC267F", "#785EF0", "#785EF0" , "#785EF0", "#FFB000", "#FFB000")[as.factor(metadat_in$compartment_BCAT)])
legend("top",legend=c("beads", "Bulk_SoilTotal_DNA" ,      "neg control"   ,  "NoduleBONCAT_Active"    ,  "NoduleInactive"     ,      "RhizosphereBONCAT_Active",
"RhizosphereInactive","RhizosphereTotal_DNA" ,    "RootsBONCAT_Active"   ,    "RootsInactive"),
pch=c(15,5,0,1,2 , 1, 2 , 5, 1, 2),
col= c("black", "#739AFF", "black", "#DC267F", "#DC267F", "#785EF0", "#785EF0" , "#785EF0", "#FFB000", "#FFB000"),
bty = "n",
inset = c(.05, 0))
setwd("C:/Users/Jenn/The Pennsylvania State University/Burghardt, Liana T - Burghardt Lab Shared Folder/Projects/BONCAT/Data/")
svg(file="figures/16s/Pcoa.svg",width = 7, height=6 )
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1,2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(p, col=c("black"),
pch=c(22,21,0,24, 23 )[as.factor(metadat_in$Fraction)],
lwd=1,cex=2,
bg=c("black", "#739AFF", "white", "#DC267F", "#DC267F", "#785EF0", "#785EF0" , "#785EF0", "#FFB000", "#FFB000")[as.factor(metadat_in$compartment_BCAT)])
legend("top",legend=c("beads", "Bulk_SoilTotal_DNA" ,      "neg control"   ,  "NoduleBONCAT_Active"    ,  "NoduleInactive"     ,      "RhizosphereBONCAT_Active",
"RhizosphereInactive","RhizosphereTotal_DNA" ,    "RootsBONCAT_Active"   ,    "RootsInactive"),
pch=c(15,5,0,1,2 , 1, 2 , 5, 1, 2),
col= c("black", "#739AFF", "black", "#DC267F", "#DC267F", "#785EF0", "#785EF0" , "#785EF0", "#FFB000", "#FFB000"),
bty = "n",
inset = c(.05, 0))
dev.off()
#------------subset by groups------------
# Store coordinates for axes 3 adn 4 in new variable #
otus.p <- otus.pcoa$points[,1:4]
otus.p
# subset
plant.p<-otus.p[which(metadat$Fraction != "Total_Cells"),]
plant.p<-plant.p[which(metadat_in$Compartment !="Rhizosphere" & metadat_in$Compartment !="Bulk_Soil" ),]
# Calculate % variance explained by each axis #
otus.eig<-otus.pcoa$eig
perc.exp<-otus.eig/(sum(otus.eig))*100
pe1<-perc.exp[1]
pe2<-perc.exp[2]
pe3<-perc.exp[3]
pe4<-perc.exp[4]
pe5<-perc.exp[5]
#to make coloring things easier I'm gong to added a combined fractionXboncat column no sure if i need this
metadat_pl<-metadat%>% filter(Compartment !="Rhizosphere") %>% filter(Compartment!="Bulk_Soil") %>% filter(Fraction != "Total_Cells")
as.factor(metadat_pl$Fraction)
as.factor(metadat_pl$Compartment)
as.factor(metadat_pl$compartment_BCAT)
plant.p
plant.p
otus.pcoa,choices=c(1,2)
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3 (",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(plant.p,
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
plant.p
points(plant.p[3,4],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3 (",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(plant.p[3,4],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
plant.p[3,4]
points(plant.p[,3:4],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
points(plant.p[,2:3],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
ordiplot(otus.pcoa,choices=c(2,3), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3 (",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(plant.p[,2:3],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
ordiplot(otus.pcoa,choices=c(2,3), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA2 (",round(pe2, 2),"% variance explained)"),
ylab=paste("PCoA3 (",round(pe3,2),"% variance explained)"))
points(plant.p[,2:3],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
points(plant.p[,3:4],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3 (",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(plant.p[,3:4],
pch=c(22,21,0,24)[as.factor(metadat_pl$Fraction)],
lwd=1,cex=2,
bg=c("black", "white", "#DC267F", "#DC267F",  "#FFB000", "#FFB000")[as.factor(metadat_pl$compartment_BCAT)])
##################### soil and rhizosphere #############
# Store coordinates for axes 3 adn 4 in new variable #
otus.p <- otus.pcoa$points[,1:4]
# subset
soil.p<-otus.p[which(metadat$Fraction != "Total_Cells"),]
soil.p<-soil.p[which(metadat_in$Compartment !="Nodule" & metadat_in$Compartment !="Roots" ),]
# Calculate % variance explained by each axis #
otus.eig<-otus.pcoa$eig
perc.exp<-otus.eig/(sum(otus.eig))*100
pe1<-perc.exp[1]
pe2<-perc.exp[2]
pe3<-perc.exp[3]
pe4<-perc.exp[4]
pe5<-perc.exp[5]
#to make coloring things easier I'm gong to added a combined fractionXboncat column no sure if i need this
metadat_so<-metadat%>% filter(Compartment !="Nodule") %>% filter(Compartment!="Roots") %>% filter(Fraction != "Total_Cells")
as.factor(metadat_so$Fraction)
as.factor(metadat_so$Compartment)
as.factor(metadat_so$compartment_BCAT)
ordiplot(otus.pcoa,choices=c(1,2), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA1 (",round(pe1, 2),"% variance explained)"),
ylab=paste("PCoA2 (",round(pe2,2),"% variance explained)"))
points(soil.p,
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
points(soil.p[,2:3],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
ordiplot(otus.pcoa,choices=c(2,3), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA2(",round(pe2, 2),"% variance explained)"),
ylab=paste("PCoA3 (",round(pe3,2),"% variance explained)"))
points(soil.p[,2:3],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
## Plot ordination with factors coloured and shaped as you like #
#setwd("C:/Users/Jenn/The Pennsylvania State University/Burghardt, Liana T - Burghardt Lab Shared Folder/Projects/BONCAT/Data/")
svg(file="figures/16s/Pc2.pc3.soil.svg",width = 6, height=6 )
ordiplot(otus.pcoa,choices=c(2,3), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA2(",round(pe2, 2),"% variance explained)"),
ylab=paste("PCoA3 (",round(pe3,2),"% variance explained)"))
points(soil.p[,2:3],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
dev.off()
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
ordiplot(otus.pcoa,choices=c(2,3), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA2(",round(pe2, 2),"% variance explained)"),
ylab=paste("PCoA3 (",round(pe3,2),"% variance explained)"))
points(soil.p[,2:3],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
windows(title="PCoA on plant asvs- Bray Curtis", width = 7, height = 6)
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA2(",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(soil.p[,3:4],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
# bulk soil = blue
# rhizzo = purple
# ctl = white
# bead = black
# active = circle
# inactive = trangle
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3(",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(soil.p[,3:4],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
# bulk soil = blue
# rhizzo = purple
# ctl = white
# bead = black
# active = circle
# inactive = trangle
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
#setwd("C:/Users/Jenn/The Pennsylvania State University/Burghardt, Liana T - Burghardt Lab Shared Folder/Projects/BONCAT/Data/")
svg(file="figures/16s/Pc3.pc4.soil.svg",width = 6, height=6 )
ordiplot(otus.pcoa,choices=c(3,4), type="none", main="PCoA of 16S OTU Bray Curtis",xlab=paste("PCoA3(",round(pe3, 2),"% variance explained)"),
ylab=paste("PCoA4 (",round(pe4,2),"% variance explained)"))
points(soil.p[,3:4],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
# bulk soil = blue
# rhizzo = purple
# ctl = white
# bead = black
# active = circle
# inactive = trangle
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
dev.off()
## Plot ordination with factors coloured and shaped as you like #
#setwd("C:/Users/Jenn/The Pennsylvania State University/Burghardt, Liana T - Burghardt Lab Shared Folder/Projects/BONCAT/Data/")
svg(file="figures/16s/Pc2.pc3.soil.svg",width = 6, height=6 )
ordiplot(otus.pcoa,choices=c(2,3), type="none", main="PCoA of Bray Curtis",xlab=paste("PCoA2(",round(pe2, 2),"% variance explained)"),
ylab=paste("PCoA3 (",round(pe3,2),"% variance explained)"))
points(soil.p[,2:3],
pch=c(22,21,0,24, 23)[as.factor(metadat_so$Fraction)],
lwd=1,cex=2,
bg=c("black","#739AFF", "white", "#785EF0", "#785EF0",  "#785EF0")[as.factor(metadat_so$compartment_BCAT)])
# bulk soil = blue
# rhizzo = purple
# ctl = white
# bead = black
# active = circle
# inactive = trangle
legend("topleft",legend=c("Flow cyto control", "Bulk soil total DNA", " PCR control",  "Rhizosphere BONCAT_Active" , "Rhizosphere Inactive",  "Rhizosphere Total DNA"),
pch=c(15,5, 0, 1,2,5),
cex=1.1,
col=c("black", "#739AFF",  "black", "#785EF0", "#785EF0",  "#785EF0"),
bty = "n")
dev.off()
## Set the working directory; modify to your own ###
setwd("C:/Users/Jenn/OneDrive - The Pennsylvania State University/Documents/Github/BONCAT_gradients/data")
### Import Data ###
taxon <- read.table("16s/taxonomy.txt", sep="\t", header=T, row.names=1)
otus.raw <- read.table("16s/feature-table.tsv", sep="\t", header=T, row.names = 1 )
metadat <- read.delim("16s/metadata.txt", sep="\t", header = T, check.names=FALSE)
## Transpose OTU table ##
otus.t <- t(otus.raw)
## order metadata
metadat<-metadat[order(metadat$SampleID),]
## order otu table
otus.t<-otus.t[order(row.names(otus.t)),]
## Determine minimum available reads per sample ##
min(rowSums(otus.t))
### Rarefy to obtain even numbers of reads by sample ###
set.seed(336)
otus.r<-rrarefy(otus.t, 41610)
#rarecurve
S <- specnumber(otus.t) # observed number of species
raremax <- min(rowSums(otus.t))
out<-rarecurve(otus.t, step = 20, sample = raremax, col = "blue", cex = 0.6)
